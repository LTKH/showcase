//function loadPage(url) {
//    console.log(url);
//    history.pushState('', 'Showcase', url);
//}

(function($) {

    $.fn.treeControl = function(x) {
        if (x.action === "create") {
            this.empty();

            var menu = [];

            function get_nodes(nodes, id) {
                //console.log(id);
                var sub = [];
                if (nodes.length > 0) {
                    $.each(nodes, function(undefined, n) {
                        console.log(id + '/' + n.id);
                        sub.push('<li class="has-sub">');
                        sub.push('<a href="' + id + '/' + n.id + '" onclick="loadPage(\'' + id + '/' + n.id + '\'); return false;"><b ');
                        if (n.nodes) { sub.push('class="caret"'); }
                        sub.push('></b>' + n.text + '</a>');
                        sub.push('<ul class="sub-menu closed">');
                        if (n.nodes) {
                            sub.push(get_nodes(n.nodes, id + '/' + n.id));
                        }
                        sub.push('</ul>');
                        sub.push('</li>');
                    });
                }
                return sub.join('\n');
            }

            menu.push('<ul class="nav">');
            menu.push('<li class="nav-header">Navigation</li>');
            $.each(x.data, function(undefined, s) {
                s.class = s.class || 'fa fa-th-large';
                menu.push('<li class="has-sub">');
                menu.push('<a href="/' + s.id + '" onclick="loadPage(\'/' + s.id + '\'); return false;"><b ');
                menu.push('<b class="caret"></b><i class="' + s.class + '"></i><span>' + s.text + '</span></a>');
                menu.push('<ul class="sub-menu closed">');
                if (s.nodes) { menu.push(get_nodes(s.nodes, '/' + s.id)); }
                menu.push('</ul>');
                menu.push('</li>');
            });
            menu.push('<li><a href="javascript:;" class="sidebar-minify-btn" data-click="sidebar-minify"><i class="fa fa-angle-double-left"></i></a></li>');
            menu.push('</ul>');
            return this.html(menu.join('\n'));
        }

    };

})(jQuery);